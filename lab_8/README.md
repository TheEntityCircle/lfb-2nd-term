# Лабораторная 8

Еще одним полезным навыком, который вы можете получить в рамках данного курса, является умения работать с процессами.

После того, как вы написали ваш код, скомпилировали его и слинковали, наступает следующий важный этап - запуск. 
На этом этапе, как вы уже знаете, вначале происходит поиск динамических библиотек, а потом система начинает исполнять ваши инструкции.
Обычно по жизни такого описания достаточно, но иногда нужно больше - например, если вы хотите распараллелить вашу программу.
Давайте посмотрим основы работы с процессами, чтобы вам было попроще в будущем.

## Что делаем

Жонглируем процессами.

### 0. Запускаем и смотрим.

Возможно, что-то подобное вы уже делали, но давайте еще раз аккуратно. 

Возьмите файл ```00_waiter.cpp``` или напишите свой, который делает аналогичную вещь - бесконечно ждёт ввода пользователя. 
(*Так мы имитируем зависший или просто очень долгий процесс, чтобы успеть рассмотреть его, пока он не завершился.*)
Скомпилируйте и запустите.

Этот процесс занимает тот терминал, из которого вы его запустили.
Мы можете прервать его через **Ctrl+C** или "свернуть" в фон через **Сtrl+Z**.

К работе с фоном мы вернемся немного позже, а сейчас нам нужно оставить процесс висящим и посмотреть на него через "диспетчер задач".
Для этого вам нужно либо запустить еще один терминал (это будет еще один экземпляр bash, даже если у вас виндоубунта), либо прервать первый процесс и запустить еще один вот так:
```
./a.out &
```
В качестве диспетчера задач удобно использовать top (консольный, черно-белый, обычно установлен по умолчанию) или htop (нужно ставить как отдельный пакет, зато красивый и удобный, тоже консольный).
Запустите его и найдите там ваш процесс.
В самом левом столбце будет его номер в системе (PID, process identificator).

Если вы запустите ваш бинарник несколько раз, у вас появится несколько процессов с одним названием и разными номерами.
*Обратите внимание, что если вы "прячете" процесс при помощи &, он сразу пишет вам его PID.*
Это независимые процессы с независимыми адресными пространствами, друг о друге они не знают.
В других столбцах вы видите прочую информацию о процессах - сколько памяти они занимают, сколько процессорного времени, сколько времени запущены и т.д.

Из htop вы можете довольно удобно управлять процессами - например, передавать им разные сигналы.
Выбрав конкретный процесс стрелками на клавиатуре, нажмите F9, и слева появится список возможных сигналов. 
Они стандартные, можете про них (при желании) почитать отдельно.
Чаще всего вас будет интересовать SIGKILL, который предлагается по умолчанию - так можно завершить процесс.

Поэкспериментируйте с этой механикой, создавая и удаляя процессы.

### 1. Ctrl+Z, background, foreground.

Если кто-то делал это в нулевой лабе, лучше сделайте еще раз и освежите в памяти.

Давайте посмотрим, что произошло, если вы применили Ctrl+Z к зависшему процессу. 
На самом деле, он не исчез. 
Он встал на паузу и ушел в фоновый режим. 
Вы можете найти его в диспетчере задач, он значится в списке, но не ест процессорное время.
Удалить его тоже можно.

Создайте бинарник, который не просто ждет ввода пользователя, а именно зависает, тратя ресурсы процессора - например, бесконечно бегая по циклу и перебирая какой-нибудь массив.
Запустите его, посмотрите на него через htop.
*Можете также сделать бинарник, который тратит память (берет в куче кусочки и не возвращает их на место), а потом посмотреть и на него.*
А теперь спрячьте его в фон через Ctrl+Z и снова посмотрите на диспетчер задач.

Вернуть процесс обратно (и снять с паузы) можно с помощью команды fg – пишете fg и часть названия процесса, он умный, сам найдет нужный (например, fg ./1 или fg a.). Полный список того, что есть в фоне, можно посмотреть командой jobs. Если там несколько с одинаковым названием, обращаться к ним можно по номерам.

Если вы хотите, чтобы процесс висел в фоне, но при этом работал, его можно снять с паузы командой bg. Так же пишете bg ./1, он остается в фоне, его можно смотреть с помощью команды jobs, но в htop вы увидите, что он работает и ест процессор.

Поэкспериментируйте и с этой механикой. 
Посмотрите, как она соотносится с & из предыдущего пункта.
Она несложная, но может оказаться полезной.

### 2. Файлы и синхронизация.
### 3. Потоки (threads).

## Что сдаем

На половину плюса - 

На полный плюс -  
